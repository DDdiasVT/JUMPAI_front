<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JumpPro Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800 antialiased min-h-screen flex flex-col">

    <header class="w-full py-6 px-4 bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold tracking-tight">JumpPro <span class="text-blue-600">Analytics</span></h1>
            <a href="#analise" class="bg-blue-600 text-white px-5 py-2 rounded-full font-medium text-sm">Nova An√°lise</a>
        </div>
    </header>

    <main class="flex-grow">
        <section class="max-w-4xl mx-auto px-4 py-12 text-center">
            <h2 class="text-4xl font-extrabold mb-4">Descubra a Ci√™ncia do seu Salto</h2>
            
            <div id="analise" class="bg-white rounded-2xl shadow-xl p-6 md:p-10 text-left relative overflow-hidden">
                
                <div id="loadingOverlay" class="absolute inset-0 bg-white/90 z-50 hidden flex-col items-center justify-center">
                    <div class="animate-spin rounded-full border-4 border-blue-600 border-t-transparent h-12 w-12 mb-4"></div>
                    <h3 class="text-xl font-bold">Analisando Biomec√¢nica...</h3>
                    <p class="text-sm text-gray-500">Isso pode levar at√© 1 minuto.</p>
                </div>

                <form id="jumpForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <input type="text" id="nome" required class="w-full px-4 py-3 border rounded-lg" placeholder="Nome">
                        <input type="tel" id="telefone" required class="w-full px-4 py-3 border rounded-lg" placeholder="WhatsApp">
                        <input type="email" id="email" required class="w-full px-4 py-3 border rounded-lg" placeholder="Email">
                        <input type="number" id="altura_user" step="0.01" required class="w-full px-4 py-3 border rounded-lg" placeholder="Sua Altura (m)">
                    </div>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <input id="video" type="file" accept="video/mp4,video/mov" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 transition">ANALISAR AGORA</button>
                </form>
            </div>

            <!-- RESULTADOS -->
            <div id="resultsSection" class="hidden mt-12 text-left">
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="bg-gray-900 text-white p-6">
                        <h3 class="text-xl font-bold">An√°lise Conclu√≠da</h3>
                    </div>
                    
                    <div class="p-6">
                        <!-- PLAYER DE V√çDEO PROCESSADO -->
                        <div class="mb-8 bg-black rounded-xl overflow-hidden aspect-video flex items-center justify-center">
                            <video id="videoResult" controls class="w-full h-full object-contain"></video>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-center">
                            <div class="bg-blue-50 p-4 rounded-xl"><p class="text-xs font-bold text-gray-500">ALTURA</p><p id="resAltura" class="text-2xl font-bold text-blue-600">--</p></div>
                            <div class="bg-purple-50 p-4 rounded-xl"><p class="text-xs font-bold text-gray-500">DIP</p><p id="resDip" class="text-2xl font-bold text-purple-600">--</p></div>
                            <div class="bg-green-50 p-4 rounded-xl"><p class="text-xs font-bold text-gray-500">EXPLOS√ÉO</p><p id="resExtensao" class="text-2xl font-bold text-green-600">--</p></div>
                            <div class="bg-yellow-50 p-4 rounded-xl"><p class="text-xs font-bold text-gray-500">RITMO</p><p id="resTempo" class="text-2xl font-bold text-yellow-600">--</p></div>
                        </div>

                        <div id="resPlano" class="bg-gray-50 p-6 rounded-xl text-sm whitespace-pre-line mb-8"></div>

                        <div class="text-center">
                            <a id="buyButton" href="#" target="_blank" class="inline-block bg-green-600 text-white font-bold py-4 px-10 rounded-full hover:bg-green-700 shadow-lg transform hover:scale-105 transition">
                                üëâ Desbloquear Treino Completo (R$ 17,00)
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        const API_URL = "https://motor-ia-832830832022.us-central1.run.app/analisar_salto/";

        document.getElementById('jumpForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const videoFile = document.getElementById('video').files[0];
            if (!videoFile) return alert("Selecione um v√≠deo!");

            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.getElementById('loadingOverlay').classList.add('flex');

            const formData = new FormData();
            formData.append('video', videoFile);
            formData.append('nome', document.getElementById('nome').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('telefone', document.getElementById('telefone').value);
            formData.append('altura_user', document.getElementById('altura_user').value);

            try {
                const response = await fetch(API_URL, { method: 'POST', body: formData });
                if (!response.ok) throw new Error('Erro na an√°lise. Tente um v√≠deo menor.');
                const data = await response.json();
                
                if (data.status === "ok") {
                    document.getElementById('resAltura').textContent = data.metricas.altura.toFixed(1) + " cm";
                    document.getElementById('resDip').textContent = Math.round(data.metricas.dip) + "¬∞";
                    document.getElementById('resExtensao').textContent = Math.round(data.metricas.extensao) + "¬∞";
                    document.getElementById('resTempo').textContent = data.metricas.tempo.toFixed(2) + " s";
                    
                    document.getElementById('resPlano').innerText = data.plano.replace(/\*\*/g, '');
                    
                    if (data.link_pagamento) document.getElementById('buyButton').href = data.link_pagamento;

                    // --- EXIBIR V√çDEO ---
                    if (data.video_base64) {
                        const videoBlob = await (await fetch(`data:video/mp4;base64,${data.video_base64}`)).blob();
                        const videoUrl = URL.createObjectURL(videoBlob);
                        document.getElementById('videoResult').src = videoUrl;
                    }

                    document.getElementById('resultsSection').classList.remove('hidden');
                    document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                alert("Erro: " + error.message);
            } finally {
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('loadingOverlay').classList.remove('flex');
            }
        });
    </script>
</body>
</html>
