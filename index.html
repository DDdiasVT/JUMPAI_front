<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STOUT.IO | Biomec√¢nica de Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@500;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .loader { border-top-color: #a3e635; -webkit-animation: spinner 1s linear infinite; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow-x: hidden; overflow-y: visible !important; }
        .glass-dark { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .tab-active { border-bottom-color: #a3e635; color: #a3e635; }
        .tab-inactive { border-bottom-color: transparent; color: #64748b; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 antialiased min-h-screen flex flex-col selection:bg-lime-400 selection:text-slate-900">

    <header class="w-full py-5 px-6 bg-slate-950/80 backdrop-blur-md sticky top-0 z-50 border-b border-white/5">
        <div class="max-w-5xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-lime-400 rounded flex items-center justify-center shadow-[0_0_15px_rgba(163,230,53,0.3)]">
                    <span class="text-slate-950 font-black text-lg">S</span>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-white">
                    STOUT<span class="text-lime-400">.IO</span>
                </h1>
            </div>
            <a href="#analise" id="headerActionBtn" class="bg-lime-400/10 hover:bg-lime-400/20 text-lime-400 border border-lime-400/20 px-5 py-2 rounded-lg font-medium transition-all text-xs uppercase tracking-wider backdrop-blur-sm">
                FAZER LOGIN
            </a>
        </div>
    </header>

    <main class="flex-grow relative">
        <div class="absolute top-[-10%] left-1/2 -translate-x-1/2 w-[600px] h-[500px] bg-lime-500/10 rounded-full blur-[100px] pointer-events-none"></div>

        <section class="max-w-4xl mx-auto px-4 py-16 md:py-24 text-center relative z-10">
            
            <div class="inline-flex items-center gap-2 mb-8 px-3 py-1 rounded-full bg-slate-900 border border-slate-800 text-lime-400 text-[10px] font-bold tracking-widest uppercase">
                <span class="w-2 h-2 rounded-full bg-lime-400 animate-pulse"></span>
                System Online v2.1 (SaaS)
            </div>

            <h2 class="text-5xl md:text-7xl font-black mb-6 leading-tight tracking-tight text-white">
                Sua Impuls√£o <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-lime-400 to-emerald-400">Decodificada.</span>
            </h2>
            
            <p class="text-lg text-slate-400 mb-12 max-w-xl mx-auto leading-relaxed">
                Use a tecnologia <strong>STOUT Vision‚Ñ¢</strong> para analisar sua biomec√¢nica frame a frame. Receba m√©tricas de elite e treinos corretivos da IA.
            </p>
            
            <div id="analise" class="glass-dark rounded-2xl shadow-2xl p-6 md:p-10 text-left relative overflow-hidden">
                <div id="loadingOverlay" class="absolute inset-0 bg-slate-950/95 z-50 hidden flex-col items-center justify-center text-center backdrop-blur-sm">
                    <div class="loader ease-linear rounded-full border-4 border-slate-800 border-t-lime-400 h-14 w-14 mb-6"></div>
                    <h3 class="text-xl font-bold text-white tracking-tight">Processando Biomec√¢nica...</h3>
                    <p class="text-slate-500 text-sm mt-2 font-mono">Calculando vetores de for√ßa e gravidade.</p>
                </div>
                
                <div id="authScreen" class="space-y-6">
                    <h3 class="text-2xl font-bold mb-4 text-center text-white">Acesso Restrito - Use Seus Cr√©ditos</h3>
                    
                    <div class="flex border-b border-slate-700 mb-6">
                        <button id="loginTabBtn" class="py-3 px-6 text-sm font-bold border-b-2 tab-active transition-colors duration-150">
                            1. Entrar (Login)
                        </button>
                        <button id="registerTabBtn" class="py-3 px-6 text-sm font-bold tab-inactive transition-colors duration-150">
                            2. Criar Conta
                        </button>
                    </div>

                    <form id="loginForm" class="space-y-4">
                        <input type="email" id="loginEmail" required class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="E-mail">
                        <input type="password" id="loginPassword" required class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="Senha">
                        <button type="submit" class="w-full bg-lime-400 hover:bg-lime-500 text-slate-950 font-black py-3 rounded-xl transition">ENTRAR</button>
                    </form>

                    <form id="registerForm" class="space-y-4 hidden">
                        <input type="email" id="registerEmail" required class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="E-mail">
                        <input type="password" id="registerPassword" required class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="Senha">
                        <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-black py-3 rounded-xl transition">CADASTRAR (5 Cr√©ditos B√¥nus)</button>
                    </form>
                </div>
                <form id="jumpForm" class="space-y-6 hidden"> 
                    <div id="statusHeader" class="text-center mb-6 p-3 bg-slate-800 rounded-lg border border-slate-700">
                        <p class="text-sm font-medium text-slate-400">
                            Logado como <span id="userEmailDisplay" class="font-bold text-lime-400"></span>.
                            Saldo: <span id="creditBalance" class="font-bold text-lime-400">--</span> cr√©ditos.
                            (<a href="#" id="logoutBtn" class="text-red-500 hover:text-red-400 ml-2">Sair</a>)
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-wide ml-1">Nome Completo</label>
                            <input type="text" id="nome" required class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="Ex: Jo√£o Silva">
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-wide ml-1">WhatsApp</label>
                            <input type="tel" id="telefone" required class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="(11) 99999-9999">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-wide ml-1">E-mail (Seu Login)</label>
                            <input type="email" id="email" required disabled class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="seu@email.com">
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-slate-400 uppercase tracking-wide ml-1">Sua Altura (m)</label>
                            <input type="number" id="altura_user" step="0.01" min="1.00" max="2.50" required class="w-full px-4 py-3 rounded-lg bg-slate-900 border border-slate-700 text-white focus:ring-1 focus:ring-lime-400 outline-none transition placeholder-slate-600" placeholder="Ex: 1.85">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wide ml-1">V√≠deo do Salto (Perfil)</label>
                        <div id="uploadTrigger" class="group relative flex justify-center px-6 pt-8 pb-8 border-2 border-slate-700 border-dashed rounded-xl hover:bg-slate-800/50 hover:border-lime-500/50 transition cursor-pointer">
                            <div class="space-y-2 text-center">
                                <i class="fa-solid fa-cloud-arrow-up text-3xl text-slate-500 group-hover:text-lime-400 transition-colors mb-2"></i>
                                <div class="flex text-sm text-slate-300 justify-center">
                                    <span class="relative rounded-md font-medium text-lime-400 hover:text-lime-300">Clique para selecionar o v√≠deo</span>
                                </div>
                                <p class="text-xs text-slate-500">MP4 ou MOV at√© 200MB</p>
                                <p id="fileName" class="text-sm font-semibold text-lime-400 mt-2 font-mono"></p>
                            </div>
                        </div>
                        <input id="video" name="video" type="file" class="hidden" accept="video/mp4,video/mov,video/quicktime">
                    </div>

                    <button type="submit" class="w-full bg-lime-400 hover:bg-lime-500 text-slate-950 font-black py-4 rounded-xl shadow-[0_0_20px_rgba(163,230,53,0.3)] transform hover:scale-[1.01] transition-all flex items-center justify-center gap-2 uppercase tracking-wider text-sm">
                        <span>üöÄ ANALISAR (Gasta 1 Cr√©dito)</span>
                    </button>
                </form>
                </div>

            <div class="max-w-md mx-auto mt-12 text-center">
                <p class="text-slate-500 text-xs uppercase tracking-widest font-bold mb-4">Recuperar Treino</p>
                <div class="glass-dark p-1 rounded-xl flex border border-slate-800 focus-within:border-lime-400 transition-colors">
                    <input type="text" id="tokenRecuperacao" placeholder="Token de Acesso R√°pido" class="bg-transparent text-white w-full px-4 py-3 outline-none text-sm placeholder-slate-600">
                    <button onclick="recuperarTreino()" class="bg-slate-800 hover:bg-slate-700 text-lime-400 px-6 py-2 rounded-lg font-bold text-xs uppercase tracking-wide transition-all whitespace-nowrap">
                        Baixar Treino
                    </button>
                </div>
                <p id="msgRecuperacao" class="text-xs mt-3 h-4 font-mono"></p>
            </div>


            <div id="resultsSection" class="hidden mt-16 text-left">
                <div class="bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden shadow-2xl">
                    <div class="bg-slate-950 border-b border-slate-800 p-6 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                            <i class="fa-solid fa-chart-line text-lime-400"></i> Relat√≥rio T√©cnico
                        </h3>
                        <span class="bg-lime-400/10 border border-lime-400/20 text-lime-400 text-[10px] font-bold px-3 py-1 rounded-full">STATUS: CONCLU√çDO</span>
                    </div>
                    
                    <div class="p-6 md:p-8">
                        <div class="mb-8 bg-black rounded-xl overflow-hidden aspect-video flex items-center justify-center shadow-inner border border-slate-800">
                            <video id="videoResult" controls class="w-full h-full object-contain"></video>
                        </div>
    
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 text-center">
                                <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">Altura</p>
                                <p id="resAltura" class="text-3xl font-bold text-lime-400 font-mono">-- cm</p>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 text-center">
                                <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">Dip</p>
                                <p id="resDip" class="text-3xl font-bold text-purple-400 font-mono">--¬∞</p>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 text-center">
                                <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">Explos√£o</p>
                                <p id="resExtensao" class="text-3xl font-bold text-blue-400 font-mono">--¬∞</p>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700 text-center">
                                <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider mb-1">Ritmo</p>
                                <p id="resTempo" class="text-3xl font-bold text-yellow-400 font-mono">-- s</p>
                            </div>
                        </div>
        
                        <div class="prose prose-invert max-w-none">
                            <h4 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                                <i class="fa-solid fa-brain text-purple-500"></i> An√°lise Neural
                            </h4>
                            <div id="resPlano" class="bg-slate-950 p-8 rounded-xl border border-slate-800 text-slate-300 text-sm leading-relaxed whitespace-pre-line font-mono"></div>
                        </div>
        
                        <div id="ctaArea" class="mt-10 bg-gradient-to-r from-lime-400 to-emerald-400 rounded-xl p-8 text-slate-950 text-center shadow-lg relative overflow-hidden group">
                            <h3 class="text-2xl font-black mb-2 tracking-tight">Acabaram Seus Cr√©ditos?</h3>
                            <p class="text-slate-900 mb-8 text-sm max-w-md mx-auto">Compre mais 5, 10 ou 20 an√°lises para continuar evoluindo.</p>
                            <a id="buyButton" href="LINK_DO_SEU_CHECKOUT_AQUI" target="_blank" class="inline-block bg-slate-950 text-lime-400 font-black py-4 px-10 rounded-full hover:bg-slate-800 transition shadow-xl transform hover:-translate-y-1">
                                üí∞ COMPRAR CR√âDITOS AGORA
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-slate-950 border-t border-slate-900 mt-12 py-10">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <p class="text-slate-600 text-xs">&copy; 2025 STOUT.IO. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        // --- CONFIG ---.
        // URL DE PRODU√á√ÉO DO SEU CLOUD RUN
        const BASE_URL = "https://motor-ia-832830832022.us-central1.run.app"; 
        const API_ANALISE_URL = `${BASE_URL}/analisar_salto/`;

        // --- ELEMENTOS UI ---
        const authScreen = document.getElementById('authScreen');
        const jumpForm = document.getElementById('jumpForm');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginTabBtn = document.getElementById('loginTabBtn');
        const registerTabBtn = document.getElementById('registerTabBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const statusHeader = document.getElementById('statusHeader');
        const userEmailDisplay = document.getElementById('userEmailDisplay');
        const creditBalanceDisplay = document.getElementById('creditBalance');
        const fileNameDisplay = document.getElementById('fileName');
        const fileInput = document.getElementById('video');
        const logoutBtn = document.getElementById('logoutBtn');
        const headerActionBtn = document.getElementById('headerActionBtn');
        const emailInputForm = document.getElementById('email');
        const tokenRecuperacaoInput = document.getElementById('tokenRecuperacao');
        const msgRecuperacao = document.getElementById('msgRecuperacao');

        // --- FUN√á√ïES DE SEGURAN√áA E L√ìGICA DE NEG√ìCIO ---

        // A FUN√á√ÉO CORRIGIDA: Lida com o erro 404 ao montar a URL
        async function apiRequest(endpoint, formData, isLogin = false) {
            
            // 1. Limpa as barras extras da URL base
            const cleanedBaseUrl = BASE_URL.replace(/\/+$/, '');
            // 2. Garante que o endpoint come√ßa com uma barra
            const cleanedEndpoint = endpoint.startsWith('/') ? endpoint : '/' + endpoint;
            
            const url = cleanedBaseUrl + cleanedEndpoint; 
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData.toString()
                });
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || data.mensagem || 'Erro desconhecido na API.');
                }
                return data;
            } catch (error) {
                alert(`Erro na API: ${error.message}`);
                if (isLogin) handleLogout();
                return null;
            }
        }

        function handleLogout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('user_email');
            localStorage.removeItem('user_credits');
            checkAuthStatus();
        }

        function showAuthTab(tabName) {
            if (tabName === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                loginTabBtn.classList.add('tab-active');
                loginTabBtn.classList.remove('tab-inactive');
                registerTabBtn.classList.add('tab-inactive');
                registerTabBtn.classList.remove('tab-active');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                registerTabBtn.classList.add('tab-active');
                registerTabBtn.classList.remove('tab-inactive');
                loginTabBtn.classList.add('tab-inactive');
                loginTabBtn.classList.remove('tab-active');
            }
        }

        function checkAuthStatus() {
            const token = localStorage.getItem('access_token');
            const email = localStorage.getItem('user_email');
            const credits = localStorage.getItem('user_credits');

            if (token && email) {
                // USU√ÅRIO LOGADO: MOSTRA O FORM DE AN√ÅLISE
                authScreen.classList.add('hidden');
                jumpForm.classList.remove('hidden');
                
                userEmailDisplay.textContent = email;
                creditBalanceDisplay.textContent = credits || 'N/A';
                emailInputForm.value = email; 

                headerActionBtn.textContent = `Saldo: ${credits} cr√©ditos`;
                headerActionBtn.classList.add('bg-lime-400/10', 'text-lime-400', 'border-lime-400/20');
                headerActionBtn.classList.remove('bg-white/5', 'text-white');
            } else {
                // USU√ÅRIO DESLOGADO: MOSTRA A TELA DE LOGIN/CADASTRO
                authScreen.classList.remove('hidden');
                jumpForm.classList.add('hidden');
                
                headerActionBtn.textContent = 'FAZER LOGIN';
                headerActionBtn.classList.remove('bg-lime-400/10', 'text-lime-400', 'border-lime-400/20');
                headerActionBtn.classList.add('bg-white/5', 'text-white');
                
                showAuthTab('login'); // Inicia na aba de Login
            }
        }
        
        // --- FUN√á√ÉO DE RECUPERA√á√ÉO DE TREINO (POR TOKEN) ---
        async function recuperarTreino() {
            const token = tokenRecuperacaoInput.value;
            
            if(!token) {
                msgRecuperacao.textContent = "Digite o Token de Acesso.";
                msgRecuperacao.className = "text-xs mt-3 h-4 font-mono text-red-400";
                return;
            }
            msgRecuperacao.textContent = "Buscando nos arquivos...";
            msgRecuperacao.className = "text-xs mt-3 h-4 font-mono text-yellow-400 animate-pulse";

            const formData = new URLSearchParams();
            formData.append('token', token);

            try {
                // Rota corrigida para usar o TOKEN em vez de e-mail
                const response = await fetch(`${BASE_URL}/recuperar_treino_token/`, { method: 'POST', body: formData });
                const data = await response.json();

                if (data.status === "encontrado") {
                    msgRecuperacao.textContent = "ACESSO PERMITIDO. Abrindo PDF...";
                    msgRecuperacao.className = "text-xs mt-3 h-4 font-mono text-lime-400";
                    window.open(data.link_pdf, '_blank');
                } else {
                    msgRecuperacao.textContent = "Token inv√°lido ou expirado.";
                    msgRecuperacao.className = "text-xs mt-3 h-4 font-mono text-red-400";
                }
            } catch (e) {
                msgRecuperacao.textContent = "Erro de conex√£o.";
                msgRecuperacao.className = "text-xs mt-3 h-4 font-mono text-red-400";
            }
        }
        
        // --- HANDLERS DE AUTENTICA√á√ÉO ---

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const formData = new URLSearchParams();
            formData.append('email', email);
            formData.append('password', password);

            const data = await apiRequest('/token', formData, true); 
            
            if (data && data.access_token) {
                localStorage.setItem('access_token', data.access_token);
                localStorage.setItem('user_email', email);
                
                // Assume 5 cr√©ditos iniciais na primeira UX
                if (!localStorage.getItem('user_credits')) {
                    localStorage.setItem('user_credits', 5);
                }
                
                checkAuthStatus();
            }
        });

        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            const formData = new URLSearchParams();
            formData.append('email', email);
            formData.append('password', password);

            const data = await apiRequest('/register/', formData);

            if (data && data.status === "sucesso") {
                alert(`Cadastro OK! ${data.mensagem}. Fa√ßa Login agora.`);
                showAuthTab('login');
            }
        });
        
        // --- L√ìGICA DE AN√ÅLISE (PROTEGIDA POR TOKEN) ---

        document.getElementById('jumpForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const token = localStorage.getItem('access_token');
            const current_email = localStorage.getItem('user_email');
            
            if (!token) {
                alert("Sess√£o expirada. Fa√ßa login novamente.");
                handleLogout();
                return;
            }
            
            const videoFile = document.getElementById('video').files[0];
            if (!videoFile) { alert("Por favor, selecione um v√≠deo!"); return; }

            loadingOverlay.classList.remove('hidden');
            loadingOverlay.classList.add('flex');

            const formData = new FormData();
            formData.append('video', videoFile);
            formData.append('nome', document.getElementById('nome').value);
            formData.append('email', current_email); 
            formData.append('telefone', document.getElementById('telefone').value);
            formData.append('altura_user', document.getElementById('altura_user').value);
            
            // O PONTO MAIS CR√çTICO: Enviar o Token
            formData.append('token', token); 

            try {
                const response = await fetch(API_ANALISE_URL, { method: 'POST', body: formData });
                const data = await response.json();
                
                if (response.status === 401) {
                    alert(`Token inv√°lido. Refa√ßa o login.`);
                    handleLogout(); 
                    return;
                }
                if (response.status === 403) {
                    alert(`Cr√©ditos Insuficientes. Compre mais cr√©ditos!`);
                    // N√£o faz logout. O usu√°rio precisa ver a tela de compra.
                    return;
                }

                if (!response.ok) {
                    throw new Error(data.detail || 'Erro na an√°lise.');
                }

                // Preencher Resultados
                if (data.status === "ok") {
                    localStorage.setItem('user_credits', data.creditos_restantes);
                    checkAuthStatus(); // Atualiza o header de saldo
                    
                    document.getElementById('resAltura').textContent = data.metricas.altura.toFixed(1) + " cm";
                    document.getElementById('resDip').textContent = Math.round(data.metricas.dip) + "¬∞";
                    document.getElementById('resExtensao').textContent = Math.round(data.metricas.extensao) + "¬∞";
                    document.getElementById('resTempo').textContent = data.metricas.tempo.toFixed(2) + " s";
                    
                    document.getElementById('resPlano').innerText = data.plano.replace(/\*\*/g, ''); 
                    
                    if (data.video_base64) {
                         const videoUrl = URL.createObjectURL(await (await fetch(`data:video/mp4;base64,${data.video_base64}`)).blob());
                         document.getElementById('videoResult').src = videoUrl;
                    }

                    document.getElementById('analise').classList.add('hidden');
                    document.getElementById('resultsSection').classList.remove('hidden');
                    document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
                }

            } catch (error) {
                alert("Erro: " + error.message);
            } finally {
                loadingOverlay.classList.add('hidden');
                loadingOverlay.classList.remove('flex');
            }
        });

        // --- INICIALIZA√á√ÉO E EVENTOS ---

        loginTabBtn.addEventListener('click', () => showAuthTab('login'));
        registerTabBtn.addEventListener('click', () => showAuthTab('register'));
        logoutBtn.addEventListener('click', handleLogout);
        
        document.getElementById('uploadTrigger').addEventListener('click', () => document.getElementById('video').click());
        document.getElementById('video').addEventListener('change', function() {
            if(this.files[0]) { document.getElementById('fileName').textContent = "‚úÖ " + this.files[0].name; }
        });

        // Eventos para as abas de Login/Cadastro (dentro do authScreen)
        loginTabBtn.addEventListener('click', () => showAuthTab('login'));
        registerTabBtn.addEventListener('click', () => showAuthTab('register'));


        // Inicializa√ß√£o: Verifica o token na carga da p√°gina
        
        document.addEventListener('DOMContentLoaded', checkAuthStatus);
    </script>
</body>
</html>
